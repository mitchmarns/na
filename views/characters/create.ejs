<div class="container">
  <div class="section-header text-center">
    <h1>Create New Character</h1>
    <p>Build your character for the Hockey Roleplay Hub</p>
  </div>
  
  <div class="form-container">
    <form id="characterForm" class="create-character-form" method="POST" action="/characters" enctype="multipart/form-data">
      <!-- Form navigation tabs -->
      <div class="form-tabs">
        <div class="form-tab active" data-tab="basic">Basic Info</div>
        <div class="form-tab" data-tab="hockey">Hockey Stats</div>
        <div class="form-tab" data-tab="appearance">Appearance</div>
        <div class="form-tab" data-tab="background">Background</div>
        <div class="form-tab" data-tab="media">Images</div>
      </div>
      
      <!-- Basic Info Section -->
      <div class="form-section active" id="basic-section">
        <h2 class="form-section-title">Basic Information</h2>
        
        <div class="form-group">
          <label for="characterType">Character Type</label>
          <select id="characterType" name="characterType" required>
            <option value="">Select Character Type</option>
            <option value="hockey">Hockey Player</option>
            <option value="staff">Team Staff</option>
            <option value="family">Family Member</option>
            <option value="other">Other Character</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="characterName">Character Name</label>
          <input type="text" id="characterName" name="characterName" placeholder="Full Name" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="characterAge">Age</label>
            <input type="number" id="characterAge" name="characterAge" min="16" max="80" required>
          </div>
          
          <div class="form-group">
            <label for="characterGender">Gender</label>
            <select id="characterGender" name="characterGender" required>
              <option value="">Select</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        
        <div class="hockey-specific-fields">
          <div class="form-row">
            <div class="form-group">
              <label for="characterTeam">Team</label>
              <select id="characterTeam" name="characterTeam">
                <option value="">Select Team</option>
                <% teams.forEach(function(team) { %>
                  <option value="<%= team.team_code %>"><%= team.team_name %></option>
                <% }); %>
                <option value="none">No Team / Free Agent</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="characterPosition">Position</label>
              <select id="characterPosition" name="characterPosition">
                <option value="">Select Position</option>
                <option value="center">Center</option>
                <option value="leftwing">Left Wing</option>
                <option value="rightwing">Right Wing</option>
                <option value="defense">Defense</option>
                <option value="goalie">Goalie</option>
                <option value="coach">Coach</option>
                <option value="staff">Other Staff</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="characterNumber">Jersey Number</label>
              <input type="number" id="characterNumber" name="characterNumber" min="1" max="99">
            </div>
            
            <div class="form-group">
              <label for="characterStatus">Player Status</label>
              <select id="characterStatus" name="characterStatus">
                <option value="active">Active</option>
                <option value="injured">Injured</option>
                <option value="prospect">Prospect</option>
                <option value="retired">Retired</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="relationship-fields" style="display: none;">
          <div class="form-group">
            <label for="relatedCharacter">Related To</label>
            <select id="relatedCharacter" name="relatedCharacter">
              <option value="">Select Character</option>
              <% characters.forEach(function(char) { %>
                <option value="<%= char.id %>"><%= char.character_name %></option>
              <% }); %>
            </select>
          </div>
          
          <div class="form-group">
            <label for="relationshipType">Relationship</label>
            <select id="relationshipType" name="relationshipType">
              <option value="">Select Relationship</option>
              <option value="family">Family Member</option>
              <option value="friend">Friend</option>
              <option value="partner">Partner</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="characterBio">Short Biography</label>
          <textarea id="characterBio" name="characterBio" rows="4" placeholder="Brief description of your character"></textarea>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn next-btn">Next: Hockey Stats</button>
        </div>
      </div>
      
      <!-- Hockey Stats Section -->
      <div class="form-section" id="hockey-section">
        <h2 class="form-section-title">Hockey Statistics</h2>
        <p class="form-section-description">If your character is a hockey player, fill out their statistics below. For non-players, you can skip this section.</p>
        
        <div class="hockey-player-stats">
          <h3>Physical Attributes</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="characterHeight">Height</label>
              <input type="text" id="characterHeight" name="characterHeight" placeholder="e.g. 6'2&quot;">
            </div>
            
            <div class="form-group">
              <label for="characterWeight">Weight</label>
              <input type="text" id="characterWeight" name="characterWeight" placeholder="e.g. 195 lbs">
            </div>
            
            <div class="form-group">
              <label for="characterHandedness">Shoots/Catches</label>
              <select id="characterHandedness" name="characterHandedness">
                <option value="right">Right</option>
                <option value="left">Left</option>
              </select>
            </div>
          </div>
          
          <h3>Skill Ratings</h3>
          <p class="form-helper">Rate your character's skills from 1-100, with 100 being elite NHL level.</p>
          
          <div class="stat-sliders">
            <div class="form-row">
              <div class="form-group slider-group">
                <label for="statSpeed">Speed: <span id="speedValue">75</span></label>
                <input type="range" id="statSpeed" name="statSpeed" min="1" max="100" value="75">
              </div>
              
              <div class="form-group slider-group">
                <label for="statShooting">Shooting: <span id="shootingValue">75</span></label>
                <input type="range" id="statShooting" name="statShooting" min="1" max="100" value="75">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group slider-group">
                <label for="statPassing">Passing: <span id="passingValue">75</span></label>
                <input type="range" id="statPassing" name="statPassing" min="1" max="100" value="75">
              </div>
              
              <div class="form-group slider-group">
                <label for="statDefense">Defense: <span id="defenseValue">75</span></label>
                <input type="range" id="statDefense" name="statDefense" min="1" max="100" value="75">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group slider-group">
                <label for="statChecking">Checking: <span id="checkingValue">75</span></label>
                <input type="range" id="statChecking" name="statChecking" min="1" max="100" value="75">
              </div>
              
              <div class="form-group slider-group">
                <label for="statEndurance">Endurance: <span id="enduranceValue">75</span></label>
                <input type="range" id="statEndurance" name="statEndurance" min="1" max="100" value="75">
              </div>
            </div>
          </div>
          
          <div class="goalie-stats" style="display: none;">
            <h3>Goalie Specific Skills</h3>
            <div class="form-row">
              <div class="form-group slider-group">
                <label for="statGlove">Glove: <span id="gloveValue">75</span></label>
                <input type="range" id="statGlove" name="statGlove" min="1" max="100" value="75">
              </div>
              
              <div class="form-group slider-group">
                <label for="statPositioning">Positioning: <span id="positioningValue">75</span></label>
                <input type="range" id="statPositioning" name="statPositioning" min="1" max="100" value="75">
              </div>
            </div>
          </div>
          
          <h3>Season Statistics</h3>
          <p class="form-helper">These are your character's current season statistics.</p>
          
          <div class="skater-stats">
            <div class="form-row">
              <div class="form-group">
                <label for="statGames">Games Played</label>
                <input type="number" id="statGames" name="statGames" min="0" max="82" value="0">
              </div>
              
              <div class="form-group">
                <label for="statGoals">Goals</label>
                <input type="number" id="statGoals" name="statGoals" min="0" value="0">
              </div>
              
              <div class="form-group">
                <label for="statAssists">Assists</label>
                <input type="number" id="statAssists" name="statAssists" min="0" value="0">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="statPlusMinus">+/-</label>
                <input type="number" id="statPlusMinus" name="statPlusMinus" value="0">
              </div>
              
              <div class="form-group">
                <label for="statPIM">PIM</label>
                <input type="number" id="statPIM" name="statPIM" min="0" value="0">
              </div>
              
              <div class="form-group">
                <label for="statTOI">Avg. TOI (min)</label>
                <input type="number" id="statTOI" name="statTOI" min="0" max="30" step="0.1" value="0">
              </div>
            </div>
          </div>
          
          <div class="goalie-season-stats" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label for="statGamesGoalie">Games Played</label>
                <input type="number" id="statGamesGoalie" name="statGamesGoalie" min="0" max="82" value="0">
              </div>
              
              <div class="form-group">
                <label for="statWins">Wins</label>
                <input type="number" id="statWins" name="statWins" min="0" value="0">
              </div>
              
              <div class="form-group">
                <label for="statLosses">Losses</label>
                <input type="number" id="statLosses" name="statLosses" min="0" value="0">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="statGAA">GAA</label>
                <input type="number" id="statGAA" name="statGAA" min="0" step="0.01" value="0">
              </div>
              
              <div class="form-group">
                <label for="statSavePct">Save %</label>
                <input type="number" id="statSavePct" name="statSavePct" min="0" max="1" step="0.001" value="0">
              </div>
              
              <div class="form-group">
                <label for="statShutouts">Shutouts</label>
                <input type="number" id="statShutouts" name="statShutouts" min="0" value="0">
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-outline prev-btn">Previous</button>
          <button type="button" class="btn next-btn">Next: Appearance</button>
        </div>
      </div>
      
      <!-- Appearance Section -->
      <div class="form-section" id="appearance-section">
        <h2 class="form-section-title">Appearance</h2>
        
        <div class="form-group">
          <label for="characterEthnicity">Ethnicity/Nationality</label>
          <input type="text" id="characterEthnicity" name="characterEthnicity" placeholder="e.g. Canadian, Swedish, etc.">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="characterHair">Hair Color/Style</label>
            <input type="text" id="characterHair" name="characterHair" placeholder="e.g. Brown, short">
          </div>
          
          <div class="form-group">
            <label for="characterEyes">Eye Color</label>
            <input type="text" id="characterEyes" name="characterEyes" placeholder="e.g. Blue">
          </div>
        </div>
        
        <div class="form-group">
          <label for="characterAppearance">Physical Description</label>
          <textarea id="characterAppearance" name="characterAppearance" rows="4" placeholder="Describe your character's general appearance, notable features, style of dress, etc."></textarea>
        </div>
        
        <div class="form-group">
          <label for="characterPersonality">Personality Traits</label>
          <textarea id="characterPersonality" name="characterPersonality" rows="4" placeholder="Describe your character's personality, mannerisms, and demeanor"></textarea>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-outline prev-btn">Previous</button>
          <button type="button" class="btn next-btn">Next: Background</button>
        </div>
      </div>
      
      <!-- Background Section -->
      <div class="form-section" id="background-section">
        <h2 class="form-section-title">Character Background</h2>
        
        <div class="form-group">
          <label for="characterBirthplace">Birthplace</label>
          <input type="text" id="characterBirthplace" name="characterBirthplace" placeholder="e.g. Toronto, Ontario">
        </div>
        
        <div class="form-group">
          <label for="characterEducation">Education</label>
          <input type="text" id="characterEducation" name="characterEducation" placeholder="e.g. University of Michigan">
        </div>
        
        <div class="form-group">
          <label for="characterBackground">Background Story</label>
          <textarea id="characterBackground" name="characterBackground" rows="6" placeholder="Share your character's life story, formative experiences, and how they came to be where they are now"></textarea>
        </div>
        
        <div class="form-group">
          <label for="characterHobbies">Hobbies & Interests</label>
          <textarea id="characterHobbies" name="characterHobbies" rows="3" placeholder="What does your character enjoy doing off the ice?"></textarea>
        </div>
        
        <div class="form-group">
          <label for="characterGoals">Goals & Motivations</label>
          <textarea id="characterGoals" name="characterGoals" rows="3" placeholder="What drives your character? What are they working toward?"></textarea>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-outline prev-btn">Previous</button>
          <button type="button" class="btn next-btn">Next: Images</button>
        </div>
      </div>
      
      <!-- Media Section -->
      <div class="form-section" id="media-section">
        <h2 class="form-section-title">Character Images</h2>
        <p class="form-section-description">Upload images to represent your character. You can add more images later.</p>
        
        <div class="form-group">
          <label for="profileImage">Main Profile Image</label>
          <div class="file-upload">
            <input type="file" id="profileImage" name="profileImage" accept="image/*">
            <label for="profileImage" class="file-upload-label">
              <i class="fas fa-upload"></i> Choose File
            </label>
            <span class="file-name">No file chosen</span>
          </div>
          <div class="image-preview" id="profileImagePreview"></div>
        </div>
        
        <div class="form-group">
          <label>Additional Images (optional)</label>
          <div class="file-upload">
            <input type="file" id="additionalImages" name="additionalImages" accept="image/*" multiple>
            <label for="additionalImages" class="file-upload-label">
              <i class="fas fa-upload"></i> Choose Files
            </label>
            <span class="file-name">No files chosen</span>
          </div>
          <div class="additional-images-preview" id="additionalImagesPreview"></div>
        </div>
        
        <div class="form-group">
          <label for="characterFaceReference">Face Reference (optional)</label>
          <input type="text" id="characterFaceReference" name="characterFaceReference" placeholder="e.g. Actor/Actress name for face reference">
          <p class="form-helper">If you're using a celebrity/actor as a face reference, please provide their name</p>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-outline prev-btn">Previous</button>
          <button type="submit" class="btn">Create Character</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Form tab navigation
    const formTabs = document.querySelectorAll('.form-tab');
    const formSections = document.querySelectorAll('.form-section');
    const nextButtons = document.querySelectorAll('.next-btn');
    const prevButtons = document.querySelectorAll('.prev-btn');
    
    // Tab click handlers
    formTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetTab = tab.dataset.tab;
        
        // Update active tab
        formTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding section
        formSections.forEach(section => {
          section.classList.remove('active');
          if (section.id === `${targetTab}-section`) {
            section.classList.add('active');
          }
        });
      });
    });
    
    // Next button handlers
    nextButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const currentSection = btn.closest('.form-section');
        const currentIndex = Array.from(formSections).indexOf(currentSection);
        
        if (currentIndex < formSections.length - 1) {
          // Hide current section
          currentSection.classList.remove('active');
          
          // Show next section
          formSections[currentIndex + 1].classList.add('active');
          
          // Update active tab
          formTabs.forEach(t => t.classList.remove('active'));
          formTabs[currentIndex + 1].classList.add('active');
        }
      });
    });
    
    // Previous button handlers
    prevButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const currentSection = btn.closest('.form-section');
        const currentIndex = Array.from(formSections).indexOf(currentSection);
        
        if (currentIndex > 0) {
          // Hide current section
          currentSection.classList.remove('active');
          
          // Show previous section
          formSections[currentIndex - 1].classList.add('active');
          
          // Update active tab
          formTabs.forEach(t => t.classList.remove('active'));
          formTabs[currentIndex - 1].classList.add('active');
        }
      });
    });
    
    // Show/hide fields based on character type
    const characterTypeSelect = document.getElementById('characterType');
    const hockeyFields = document.querySelector('.hockey-specific-fields');
    const relationshipFields = document.querySelector('.relationship-fields');
    
    if (characterTypeSelect && hockeyFields && relationshipFields) {
      characterTypeSelect.addEventListener('change', function() {
        if (this.value === 'hockey' || this.value === 'staff') {
          hockeyFields.style.display = 'block';
          relationshipFields.style.display = 'none';
        } else if (this.value === 'family' || this.value === 'other') {
          hockeyFields.style.display = 'none';
          relationshipFields.style.display = 'block';
        } else {
          hockeyFields.style.display = 'none';
          relationshipFields.style.display = 'none';
        }
      });
    }
    
    // Show/hide goalie specific fields
    const positionSelect = document.getElementById('characterPosition');
    const goalieStats = document.querySelector('.goalie-stats');
    const goalieSeasonStats = document.querySelector('.goalie-season-stats');
    const skaterStats = document.querySelector('.skater-stats');
    
    if (positionSelect && goalieStats && goalieSeasonStats && skaterStats) {
      positionSelect.addEventListener('change', function() {
        if (this.value === 'goalie') {
          goalieStats.style.display = 'block';
          goalieSeasonStats.style.display = 'block';
          skaterStats.style.display = 'none';
        } else {
          goalieStats.style.display = 'none';
          goalieSeasonStats.style.display = 'none';
          skaterStats.style.display = 'block';
        }
      });
    }
    
    // Update range slider value displays
    const rangeSliders = document.querySelectorAll('input[type="range"]');
    
    rangeSliders.forEach(slider => {
      const valueDisplay = document.getElementById(`${slider.id}Value`);
      
      if (valueDisplay) {
        // Initialize with current value
        valueDisplay.textContent = slider.value;
        
        // Update when slider changes
        slider.addEventListener('input', function() {
          valueDisplay.textContent = this.value;
        });
      }
    });
    
    // File upload preview
    const profileImage = document.getElementById('profileImage');
    const profileImagePreview = document.getElementById('profileImagePreview');
    const additionalImages = document.getElementById('additionalImages');
    const additionalImagesPreview = document.getElementById('additionalImagesPreview');
    
    if (profileImage && profileImagePreview) {
      profileImage.addEventListener('change', function() {
        const file = this.files[0];
        
        if (file) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            profileImagePreview.innerHTML = `<img src="${e.target.result}" alt="Profile preview">`;
          };
          
          reader.readAsDataURL(file);
          
          // Update file name display
          this.parentElement.querySelector('.file-name').textContent = file.name;
        }
      });
    }
    
    if (additionalImages && additionalImagesPreview) {
      additionalImages.addEventListener('change', function() {
        additionalImagesPreview.innerHTML = '';
        
        if (this.files.length > 0) {
          for (let i = 0; i < this.files.length; i++) {
            const file = this.files[i];
            const reader = new FileReader();
            
            reader.onload = function(e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.alt = `Additional image ${i+1}`;
              additionalImagesPreview.appendChild(img);
            };
            
            reader.readAsDataURL(file);
          }
          
          // Update file name display
          this.parentElement.querySelector('.file-name').textContent = `${this.files.length} files selected`;
        } else {
          this.parentElement.querySelector('.file-name').textContent = 'No files chosen';
        }
      });
    }
  });
</script>